<project name="BIMserver Common">
	<import file="one-jar-ant-task.xml" />
	<fileset id="lib" dir="../../BimServer">
		<include name="**/*.jar" />
		<exclude name="**tomcat*"/>
	</fileset>
	<fileset id="buildlib" dir="builds/lib">
		<include name="**/*.jar" />
	</fileset>
	<target name="Build">
		<mkdir dir="builds/lib" />
		<mkdir dir="builds/pluginlibs" />
		<antcall target="Utils" />
		<antcall target="Shared" />
		<antcall target="Ifc" />
		<antcall target="BimServerClientLib" />
		<antcall target="XsltSerializer" />
		<antcall target="BimServer" />
		<antcall target="CityGML" />
		<antcall target="Collada" />
		<antcall target="SceneJS" />
		<antcall target="IfcEngine" />
		<antcall target="Mergers" />
		<antcall target="JavaQueryEngine" />
		<antcall target="IfcPlugins" />
		<antcall target="MiscSerializers" />
		<antcall target="buildingSMARTLibrary" />
		<antcall target="FileBasedObjectIDM" />
	</target>
	<target name="Tests">
		<mkdir dir="builds/tests" />
		<javac destdir="builds/tests" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Tests/src" />
			<src path="../../Tests/test" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
					<fileset dir="builds/pluginlibs"/>
				</path>
			</classpath>
		</javac>
		<copy todir="builds/tests/static">
			<fileset dir="../../Tests/static"></fileset>
		</copy>
		<jar destfile="builds/lib/bimserver-${version}-tests.jar">
			<fileset dir="builds/tests"/>
		</jar>
	</target>
	<target name="BimServer">
		<mkdir dir="builds/bimserver" />
		<javac destdir="builds/bimserver" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../BimServer/src" />
			<src path="../../BimServer/generated" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<copy todir="builds/bimserver/org/bimserver/database/migrations/steps">
			<fileset file="../../BimServer/src/org/bimserver/database/migrations/steps/IFC2X3_TC1.ecore"></fileset>
		</copy>
		<mkdir dir="builds/bimserver/plugin"/>
		<jar destfile="builds/lib/bimserver-${version}.jar">
			<fileset dir="builds/bimserver"/>
		</jar>
	</target>
	<target name="BimServerClientLib">
		<mkdir dir="builds/bimserverclientlib" />
		<javac destdir="builds/bimserverclientlib" debug="on" fork="false" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../BimServerClientLib/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<copy todir="builds/bimserverclientlib/org/bimserver/client/protocolbuffers">
			<fileset dir="../../BimServerClientLib/src/org/bimserver/client/protocolbuffers">
				<include name="*.desc"/>
				<include name="*.proto"/>
			</fileset>
		</copy>
		<jar destfile="builds/lib/bimserver-${version}-client-lib.jar">
			<fileset dir="builds/bimserverclientlib"/>
		</jar>
	</target>
	<target name="Utils">
		<mkdir dir="builds/utils" />
		<javac destdir="builds/utils" debug="on" fork="false" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Utils/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<jar destfile="builds/lib/bimserver-${version}-utils.jar">
			<fileset dir="builds/utils"/>
		</jar>
	</target>
	<target name="FileBasedObjectIDM">
		<mkdir dir="builds/filebasedobjectidm" />
		<javac destdir="builds/filebasedobjectidm" debug="on" fork="false" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../FileBasedObjectIDM/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/filebasedobjectidm/plugin"/>
		<copy todir="builds/filebasedobjectidm/plugin">
			<fileset dir="../../FileBasedObjectIDM/plugin"></fileset>
		</copy>
		<copy todir="builds/filebasedobjectidm">
			<fileset dir="../../FileBasedObjectIDM">
				<include name="*.xml" />
			</fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-filebasedobjectidm.jar">
			<fileset dir="builds/filebasedobjectidm"/>
		</jar>
	</target>
	<target name="buildingSMARTLibrary">
		<mkdir dir="builds/buildingSMARTLibrary" />
		<javac destdir="builds/buildingSMARTLibrary" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../buildingSMARTLibrary/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/buildingSMARTLibrary/plugin"/>
		<mkdir dir="builds/buildingSMARTLibrary/schema"/>
		<copy todir="builds/buildingSMARTLibrary/schema">
			<fileset dir="../../buildingSMARTLibrary/schema"/>
		</copy>
		<copy todir="builds/buildingSMARTLibrary/plugin">
			<fileset dir="../../buildingSMARTLibrary/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-buildingSMARTLibrary.jar">
			<fileset dir="builds/buildingSMARTLibrary"/>
		</jar>
	</target>
	<target name="IfcEngine">
		<mkdir dir="builds/ifcengine" />
		<javac destdir="builds/ifcengine" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../IfcEngine/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/ifcengine/plugin"/>
		<copy todir="builds/ifcengine/lib">
			<fileset dir="../../IfcEngine/lib"/>
		</copy>
		<copy todir="builds/ifcengine/plugin">
			<fileset dir="../../IfcEngine/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-ifcengine.jar">
			<fileset dir="builds/ifcengine"/>
		</jar>
	</target>
	<target name="IfcPlugins">
		<mkdir dir="builds/ifcplugins" />
		<javac destdir="builds/ifcplugins" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../IfcPlugins/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/ifcplugins/plugin"/>
		<copy todir="builds/ifcplugins/plugin">
			<fileset dir="../../IfcPlugins/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-ifcplugins.jar">
			<fileset dir="builds/ifcplugins"/>
		</jar>
	</target>
	<target name="JavaQueryEngine">
		<mkdir dir="builds/javaqueryengine" />
		<javac destdir="builds/javaqueryengine" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../JavaQueryEngine/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/javaqueryengine/plugin"/>
		<copy todir="builds/javaqueryengine/plugin">
			<fileset dir="../../JavaQueryEngine/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-javaqueryengine.jar">
			<fileset dir="builds/javaqueryengine"/>
		</jar>
	</target>
	<target name="Mergers">
		<mkdir dir="builds/mergers" />
		<javac destdir="builds/mergers" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Mergers/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/mergers/plugin"/>
		<copy todir="builds/mergers/plugin">
			<fileset dir="../../Mergers/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-mergers.jar">
			<fileset dir="builds/mergers"/>
		</jar>
	</target>
	<target name="MiscSerializers">
		<mkdir dir="builds/miscserializers" />
		<javac destdir="builds/miscserializers" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../MiscSerializers/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/miscserializers/plugin"/>
		<copy todir="builds/miscserializers/plugin">
			<fileset dir="../../MiscSerializers/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-miscserializers.jar">
			<fileset dir="builds/miscserializers"/>
		</jar>
	</target>
	<target name="XsltSerializer">
		<mkdir dir="builds/xsltserializer" />
		<javac destdir="builds/xsltserializer" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../XsltSerializer/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<jar destfile="builds/lib/bimserver-${version}-xsltserializer.jar">
			<fileset dir="builds/xsltserializer"/>
		</jar>
	</target>
	<target name="Collada">
		<mkdir dir="builds/collada" />
		<javac destdir="builds/collada" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Collada/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/collada/plugin"/>
		<copy todir="builds/collada/plugin">
			<fileset dir="../../Collada/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-collada.jar">
			<fileset dir="builds/collada"/>
		</jar>
	</target>
	<target name="SceneJS">
		<mkdir dir="builds/scenejs" />
		<javac destdir="builds/scenejs" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../SceneJS/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/scenejs/plugin"/>
		<copy todir="builds/scenejs/plugin">
			<fileset dir="../../SceneJS/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-scenejs.jar">
			<fileset dir="builds/scenejs"/>
		</jar>
	</target>
	<target name="CityGML">
		<mkdir dir="builds/citygml" />
		<javac destdir="builds/citygml" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../CityGML/src" />
			<src path="../../CityGML/generated" />
			<classpath>
				<path>
					<fileset dir="../../CityGML/lib" />
				</path>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<mkdir dir="builds/citygml/lib"/>
		<copy todir="builds/citygml/lib">
			<fileset dir="../../CityGML/lib"/>
		</copy>
		<mkdir dir="builds/citygml/plugin"/>
		<copy todir="builds/citygml/plugin">
			<fileset dir="../../CityGML/plugin"></fileset>
		</copy>
		<jar destfile="builds/pluginlibs/bimserver-${version}-citygml.jar">
			<fileset dir="builds/citygml"/>
		</jar>
	</target>
	<target name="Ifc">
		<mkdir dir="builds/ifc" />
		<javac destdir="builds/ifc" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Ifc/src" />
			<classpath>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<jar destfile="builds/lib/bimserver-${version}-ifc.jar">
			<fileset dir="builds/ifc"/>
		</jar>
	</target>
	<target name="Shared">
		<mkdir dir="builds/shared" />
		<javac destdir="builds/shared" debug="on" includeantruntime="false" target="1.6" source="1.6">
			<src path="../../Shared/src" />
			<src path="../../Shared/generated" />
			<classpath>
				<pathelement location="../../Shared/genclasses"/>
				<path>
					<fileset refid="lib" />
					<fileset refid="buildlib" />
				</path>
			</classpath>
		</javac>
		<copy todir="builds/shared/org/bimserver/shared/interfaces">
			<fileset dir="../../Shared/src/org/bimserver/shared/interfaces">
				<include name="*.java"/>
			</fileset>
		</copy>
		<copy todir="builds/shared">
			<fileset dir="../../Shared/genclasses"></fileset>
		</copy>
		<copy file="../../Shared/generated/org/bimserver/models/ifc2x3tc1/impl/ifc2x3tc1.ecore" todir="builds/shared/org/bimserver/models/ifc2x3tc1/impl" />
		<copy file="../../Shared/generated/org/bimserver/models/store/impl/store.ecore" todir="builds/shared/org/bimserver/models/store/impl" />
		<copy file="../../Shared/generated/org/bimserver/models/log/impl/log.ecore" todir="builds/shared/org/bimserver/models/log/impl" />
		<copy todir="builds/shared/org/bimserver/shared/interfaces/bimsie1">
			<fileset dir="../../Shared/src/org/bimserver/shared/interfaces/bimsie1">
				<include name="*.java"/>
			</fileset>
		</copy>
		<jar destfile="builds/lib/bimserver-${version}-shared.jar">
			<fileset dir="builds/shared"/>
		</jar>
	</target>

	<property name="buildtargets" value="../build/targets" />
	<property name="defaultsettings" value="../defaultsettings" />
</project>
